<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ToDo登録</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    table { border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ccc; }
    th { background: #f5f5f5; text-align: left; width: 140px; }
    .required { color: #c00; }
    .error { color: #c00; }
  </style>
</head>
<body>
  <h1>ToDo登録</h1>

  <form method="post" th:action="@{/todos/confirm}" th:object="${todo}">
    <input type="hidden" th:field="*{id}">
    <table>
      <tr>
        <th>作成者 <span class="required">必須</span></th>
        <td>
          <input type="text" th:field="*{author}">
          <div class="error" th:if="${#fields.hasErrors('author')}" th:errors="*{author}"></div>
        </td>
      </tr>
      <tr>
        <th>タイトル <span class="required">必須</span></th>
        <td>
          <input type="text" th:field="*{title}">
          <div class="error" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></div>
        </td>
      </tr>
      <tr>
        <th>詳細</th>
        <td>
          <textarea rows="4" cols="40" th:field="*{detail}"></textarea>
          <div class="error" th:if="${#fields.hasErrors('detail')}" th:errors="*{detail}"></div>
        </td>
      </tr>
      <tr>
        <th>状態</th>
        <td>
          <label><input type="checkbox" th:field="*{completed}"> 完了</label>
        </td>
      </tr>
      <tr>
        <th>優先度</th>
        <td>
          <select th:field="*{priority}">
            <option th:each="p : ${priorities}" th:value="${p}" th:text="${p.displayName}"></option>
          </select>
        </td>
      </tr>
      <tr>
        <th>カテゴリ</th>
        <td>
          <select th:field="*{category.id}">
            <option value="">未分類</option>
            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
          </select>
          <a th:href="@{/categories}" style="margin-left: 8px;">カテゴリ編集</a>
        </td>
      </tr>
    </table>
    <p>
      <button type="submit">確認</button>
      <a th:href="@{/todos}">戻る</a>
    </p>
  </form>
  <form method="post" th:if="${todo.id != null}" th:action="@{/todos/{id}/delete(id=${todo.id})}" onsubmit="return confirm('削除しますか？');">
    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    <button type="submit">削除</button>
  </form>
</body>
</html>
